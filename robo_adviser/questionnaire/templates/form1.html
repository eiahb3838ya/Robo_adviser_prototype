{% extends "questionnaire_base.html" %}
{% load static %}


{% block contentInHead %}
{% endblock %}

{% block questionnaireContent %}
<div class="container">
    <div class="row">
        <form name='myform'  method="GET">
            <label for="stockpicker">Pick a stock bro</label>
            <select name="stockpicker" id="stockpicker" >
                {% for a_stock in stock_list %}
                   <option >{{a_stock}}</option>
                {% endfor %}


            </select>

            <div class="row">

            <button class= "btn" type="submit" name="action" value="strategy_smawma" formaction="{% url 'adviser:strategy_smawma' %}" >smawma</button>
            <button class= "btn" type="submit" name="action" value="strategy_bbandma" formaction="{% url 'adviser:strategy_bbandma' %}">bbandma</button>
            <button class= "btn" type="submit" name="action" value="r_strategy_result" formaction="{% url 'adviser:r_strategy_result' %}">r_strategy_result</button>

            </div>

        </form>
    </div>
    <div class="row" id="line_fig">

    </div>
</div>

</div>

{% endblock %}

{% block contentJS %}
    <script>

        //solve the thing that Disabled form elements are not sent by the form.
        //$(':disabled').each(function(){
        //    $(this).after('<input type="hidden" name="' + $(this).attr('name') + '" value="' + $(this).val() + '" />');
        //});

        //開啟的時候就先畫圖
        $(document).ready(function(){
            var endpoint = 'api/chart/data'
            var articleData =  articleLabels = []
            $.ajax({
                method:"GET",
                url:endpoint,
                data:{
                    user_picked: $('#stockpicker').val()
                },
                success:function(data){
                    articleLabels = data.article_labels;
                    articleData = data.article_data;
                    prepareChart();

                },
                error:function(e){
                    alert(e);
                }
            });
            function prepareChart(){
                var trace1 = {
                    mode: 'lines',
                    x: articleData,
                    y: articleLabels,

                };
                var data = [ trace1 ];

                var layout = {
                  title:$('#stockpicker').val()
                };

                Plotly.newPlot('line_fig', data, layout);
            };
        });

        //換標的的時候畫圖
        $('#stockpicker').change(function(){

            var endpoint = 'api/chart/data'
            var articleData =  articleLabels = []

            $.ajax({
                method:"GET",
                url:endpoint,
                data:{
                    user_picked: $('#stockpicker').val()
                },
                success:function(data){
                    articleLabels = data.article_labels;
                    articleData = data.article_data;
                    prepareChart();

                },
                error:function(e){
                    console.log(e);
                }
            });

            function prepareChart(){
                var trace1 = {
                    mode: 'lines',
                    x: articleData,
                    y: articleLabels,

                };
                var data = [ trace1 ];

                var layout = {
                  title:$('#stockpicker').val()
                };

                Plotly.newPlot('line_fig', data, layout);
            };
        });
    </script>

{% endblock %}


